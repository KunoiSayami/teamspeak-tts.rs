<!DOCTYPE html>
<html>

<head>
   <title>TTS</title>
</head>
<script>

   function submit() {
      let headMessage = document.getElementById("head-message");
      let status = document.getElementById("status");
      let value = document.getElementById("text").value;
      let r = new XMLHttpRequest();
      r.open("POST", "/", true);
      r.setRequestHeader("Content-Type", "application/json");
      r.onreadystatechange = () => {
         if (r.readyState != 4 || r.status != 200) {
            headMessage.style.display = "inline";
            status.innerText = r.responseText;
            status.style.display = "inline";
            setTimeout(() => {
               headMessage.style.display = "none";
               status.style.display = "none";
            }, 3000);
            return;
         }
      };
      r.send(JSON.stringify({ content: value }));
   }

   function clearText() {
      document.getElementById("text").value = "";
   }

   function saveText() {
      let value = document.getElementById("text").value;
      window.localStorage.setItem("tts", value);
      setTimeout(saveText, 3000);
   }

   document.addEventListener("DOMContentLoaded", function (event) {
      let textarea = document.getElementById("text");
      let s = window.localStorage.getItem("tts");
      if (s !== null) {
         textarea.value = s;
      }
      setTimeout(saveText, 3000);

      // https://stackoverflow.com/questions/1684196/
      textarea.addEventListener('keydown', e => { if (e.ctrlKey && e.keyCode === 13) submit(); })
   });
</script>

<body>
   <span id="head-message" style="display: none;">Send success</span>&nbsp;<span id="status"></span>
   <br>
   <textarea id="text" rows="5" cols="60" name="content"></textarea>
   <br>
   <button onclick="submit()">submit</button>
   <button onclick="clearText()">clear</button>

</body>

</html>